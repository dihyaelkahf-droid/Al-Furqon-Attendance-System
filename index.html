<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Absensi Karyawan - Login</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Library untuk Ekspor Excel dan PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        /* Tambahan styling khusus untuk login page */
        .system-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .system-features {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        
        .feature {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }
        
        .feature i {
            font-size: 16px;
            color: #ffd700;
        }
        
        @media (max-width: 768px) {
            .system-features {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container login-container">
        <div class="login-card">
            <div class="logo">
                <i class="fas fa-fingerprint fa-3x"></i>
                <h1>Sistem Absensi</h1>
                <p class="subtitle">AUAS AI Fungon Attendance System</p>
            </div>
            
            <div class="system-info">
                <h3><i class="fas fa-info-circle"></i> Sistem Absensi Digital</h3>
                <p>Kelola kehadiran karyawan dengan mudah dan efisien</p>
                <div class="system-features">
                    <div class="feature">
                        <i class="fas fa-check-circle"></i>
                        <span>Presensi Real-time</span>
                    </div>
                    <div class="feature">
                        <i class="fas fa-chart-bar"></i>
                        <span>Laporan Otomatis</span>
                    </div>
                    <div class="feature">
                        <i class="fas fa-clock"></i>
                        <span>Pengaturan Jam Fleksibel</span>
                    </div>
                    <div class="feature">
                        <i class="fas fa-mobile-alt"></i>
                        <span>Responsive Design</span>
                    </div>
                </div>
            </div>
            
            <div class="login-form">
                <h2><i class="fas fa-sign-in-alt"></i> Masuk ke Akun</h2>
                
                <div class="user-type-selector">
                    <button type="button" class="user-type-btn active" id="employeeBtn" data-type="employee">
                        <i class="fas fa-user-tie"></i>
                        <span>Karyawan</span>
                    </button>
                    <button type="button" class="user-type-btn" id="adminBtn" data-type="admin">
                        <i class="fas fa-user-shield"></i>
                        <span>Administrator</span>
                    </button>
                </div>
                
                <form id="loginForm">
                    <div class="form-group">
                        <label for="username">
                            <i class="fas fa-user-circle"></i> Username
                        </label>
                        <input type="text" id="username" 
                               placeholder="Masukkan username" 
                               required
                               autocomplete="username">
                        <div class="input-hint" id="usernameHint"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">
                            <i class="fas fa-lock"></i> Password
                        </label>
                        <div class="password-input">
                            <input type="password" id="password" 
                                   placeholder="Masukkan password" 
                                   required
                                   autocomplete="current-password">
                            <button type="button" class="toggle-password" id="togglePassword">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div class="input-hint" id="passwordHint"></div>
                    </div>
                    
                    <div class="form-group remember-me">
                        <input type="checkbox" id="rememberMe">
                        <label for="rememberMe">
                            <i class="far fa-save"></i> Ingat username
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary btn-block" id="loginButton">
                            <i class="fas fa-sign-in-alt"></i> 
                            <span id="loginButtonText">Masuk sebagai Karyawan</span>
                        </button>
                    </div>
                    
                    <div class="demo-credentials">
                        <h4><i class="fas fa-key"></i> Akun Demo</h4>
                        <div class="credential-item">
                            <strong><i class="fas fa-user-shield"></i> Administrator:</strong>
                            <p>Username: <code>admin</code></p>
                            <p>Password: <code>admin123</code></p>
                        </div>
                        <div class="credential-item">
                            <strong><i class="fas fa-user-tie"></i> Karyawan:</strong>
                            <p>Username: <code>sutris</code></p>
                            <p>Password: <code>sutris123</code></p>
                        </div>
                        <div class="credential-item">
                            <strong><i class="fas fa-users"></i> Karyawan Lain:</strong>
                            <p>Username: <code>nita</code>, <code>heri</code>, <code>yian</code>, dll.</p>
                            <p>Password: <code>[username]123</code></p>
                        </div>
                    </div>
                </form>
                
                <div id="loginMessage" class="message"></div>
                
                <div class="login-footer">
                    <p><i class="fas fa-cogs"></i> Versi 1.0.0</p>
                    <p><i class="far fa-copyright"></i> 2024 AUAS Attendance System</p>
                    <p class="small-text">Hak Cipta Dilindungi Undang-Undang</p>
                </div>
            </div>
        </div>
    </div>
    
    <script src="auth.js"></script>
    <script src="script.js"></script>
    
    <script>
        // Inisialisasi halaman login
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Login page loaded');
            
            // Inisialisasi data
            if (typeof auth !== 'undefined' && typeof auth.initializeData === 'function') {
                auth.initializeData();
                console.log('Data initialized');
            }
            
            // Setup login page
            setupLoginPage();
            
            // Cek jika ada user yang sudah login
            checkExistingLogin();
        });
        
        function setupLoginPage() {
            // Elemen DOM
            const employeeBtn = document.getElementById('employeeBtn');
            const adminBtn = document.getElementById('adminBtn');
            const loginForm = document.getElementById('loginForm');
            const loginButtonText = document.getElementById('loginButtonText');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            const togglePasswordBtn = document.getElementById('togglePassword');
            const rememberMe = document.getElementById('rememberMe');
            
            let currentUserType = 'employee';
            
            // Load saved username jika ada
            const savedUsername = localStorage.getItem('rememberedUsername');
            if (savedUsername) {
                usernameInput.value = savedUsername;
                rememberMe.checked = true;
            }
            
            // Toggle password visibility
            togglePasswordBtn.addEventListener('click', function() {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                this.innerHTML = type === 'password' ? 
                    '<i class="fas fa-eye"></i>' : 
                    '<i class="fas fa-eye-slash"></i>';
            });
            
            // User type selection
            employeeBtn.addEventListener('click', function() {
                currentUserType = 'employee';
                updateUserTypeSelection();
                loginButtonText.textContent = 'Masuk sebagai Karyawan';
                updateInputHints();
            });
            
            adminBtn.addEventListener('click', function() {
                currentUserType = 'admin';
                updateUserTypeSelection();
                loginButtonText.textContent = 'Masuk sebagai Administrator';
                updateInputHints();
            });
            
            function updateUserTypeSelection() {
                employeeBtn.classList.toggle('active', currentUserType === 'employee');
                adminBtn.classList.toggle('active', currentUserType === 'admin');
            }
            
            function updateInputHints() {
                const usernameHint = document.getElementById('usernameHint');
                const passwordHint = document.getElementById('passwordHint');
                
                if (currentUserType === 'admin') {
                    usernameHint.innerHTML = '<i class="fas fa-info-circle"></i> Username admin: admin';
                    passwordHint.innerHTML = '<i class="fas fa-info-circle"></i> Password admin: admin123';
                } else {
                    usernameHint.innerHTML = '<i class="fas fa-info-circle"></i> Contoh: sutris, nita, heri';
                    passwordHint.innerHTML = '<i class="fas fa-info-circle"></i> Format password: [username]123';
                }
            }
            
            // Update hints initially
            updateInputHints();
            
            // Form submission
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const username = usernameInput.value.trim();
                const password = passwordInput.value.trim();
                const isAdmin = currentUserType === 'admin';
                
                // Validasi input
                if (!username || !password) {
                    showMessage('loginMessage', 'Harap isi username dan password', 'error');
                    return;
                }
                
                // Save username jika remember me dicentang
                if (rememberMe.checked) {
                    localStorage.setItem('rememberedUsername', username);
                } else {
                    localStorage.removeItem('rememberedUsername');
                }
                
                // Attempt login
                performLogin(username, password, isAdmin);
            });
            
            // Auto-focus username field
            usernameInput.focus();
        }
        
        function performLogin(username, password, isAdmin) {
            // Show loading state
            const loginButton = document.getElementById('loginButton');
            const originalText = loginButton.innerHTML;
            loginButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Memproses...';
            loginButton.disabled = true;
            
            // Delay untuk simulasi loading (bisa dihapus di production)
            setTimeout(() => {
                try {
                    // Gunakan fungsi login dari auth.js
                    if (typeof auth === 'undefined' || typeof auth.login !== 'function') {
                        throw new Error('Sistem autentikasi tidak tersedia');
                    }
                    
                    const user = auth.login(username, password, isAdmin);
                    
                    if (user) {
                        showMessage('loginMessage', 
                            `Login berhasil! Selamat datang, ${user.name}`, 
                            'success'
                        );
                        
                        // Redirect setelah 1 detik
                        setTimeout(() => {
                            auth.redirectBasedOnRole(user);
                        }, 1000);
                    } else {
                        showMessage('loginMessage', 
                            'Username atau password salah. Silakan coba lagi.', 
                            'error'
                        );
                        resetLoginButton();
                    }
                } catch (error) {
                    console.error('Login error:', error);
                    showMessage('loginMessage', 
                        `Terjadi kesalahan: ${error.message}`, 
                        'error'
                    );
                    resetLoginButton();
                }
            }, 1000);
            
            function resetLoginButton() {
                const loginButton = document.getElementById('loginButton');
                loginButton.innerHTML = originalText;
                loginButton.disabled = false;
            }
        }
        
        function checkExistingLogin() {
            // Cek jika user sudah login
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (currentUser) {
                // Tampilkan pesan dan tawarkan untuk langsung masuk
                const confirmLogin = confirm(
                    `Anda sudah login sebagai ${currentUser.name}.\n\n` +
                    'Lanjutkan ke dashboard?'
                );
                
                if (confirmLogin) {
                    auth.redirectBasedOnRole(currentUser);
                } else {
                    // Logout jika tidak ingin lanjut
                    auth.logout();
                }
            }
        }
        
        // Fungsi untuk menampilkan pesan
        function showMessage(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = `
                <div class="message ${type}">
                    <i class="fas fa-${type === 'error' ? 'exclamation-triangle' : 
                                   type === 'success' ? 'check-circle' : 
                                   type === 'warning' ? 'exclamation-circle' : 
                                   'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            // Auto-hide setelah beberapa detik
            if (type === 'success' || type === 'error') {
                setTimeout(() => {
                    container.innerHTML = '';
                }, 5000);
            }
        }
    </script>
</body>
</html>
